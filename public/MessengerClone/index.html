<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content>
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          Post#7 Messenger Clone - Realtime Messaging Platform with Firebase - Quang
        
    </title>

    <link rel="canonical" href="https://decodecraft.com/MessengerClone/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<body ontouchstart="">
	<!-- Created by Nguyen Nhat Quang -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('605f46e0efe323669bc2a5a5b7b3835b.png')
            /*post*/
        
    }
    
    #signature{
        background-image: url('/undefined');
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#javascript" title="javascript">javascript</a>
                            
                              <a class="tag" href="/tags/#reactjs" title="reactjs">reactjs</a>
                            
                              <a class="tag" href="/tags/#nodejs" title="nodejs">nodejs</a>
                            
                              <a class="tag" href="/tags/#api" title="api">api</a>
                            
                        </div>
                        <h1>Post#7 Messenger Clone - Realtime Messaging Platform with Firebase</h1>
                        <h2 class="subheading">30-min read</h2>
                        <span class="meta">
                            Posted by Quang Nguyen on
                            2021-02-01
                        </span>
                    </div>
                
                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Quang Nguyen</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h2><span id="welcome-back-to-my-tech-blog-this-time-i-will-show-you-my-work-during-the-winter-break-messenger-clone">Welcome back to my tech blog. This time I will show you my work during the winter break: Messenger Clone</span></h2>
<p>During the winter break, as everybody knows, there were many crashes to big platforms such as Facebook and Messenger. Noticing this, I decided to create a <strong>real-time messaging</strong> platform for me and my friends (potentially become bigger in the future). I hope you will find this post interesting because it has a lot of cool techniques that I have just learned.</p>
<h3><span id="list-of-important-parts-in-the-project">List of important parts in the project:</span></h3>
<ol>
<li>Firebase Authentication system</li>
<li>Friends relationship management (add, remove friends like on Facebook)</li>
<li>Firebase storage to store and upload images</li>
<li>Real-time messaging of individuals using Firestore and Redux</li>
<li>Real-time messaging of groups using Firestore and Redux</li>
</ol>
<h3><span id="important-note">Important Note:</span></h3>
<p>One important thing to note here is that I am <strong>always</strong> using the information and the ids from Firestore not from the auto generated user of Firebase Authentication. This means that anytime the user logs in and inputs any information, it will be uploaded encriptedly to the Firestore and we will draw the information from the database down to our client.</p>
<h3><span id="setting-up-firebase-in-a-react-project">Setting Up Firebase in a React Project</span></h3>
<p>I have written a blog about how to set up firebase from start to finish <a href="https://decodecraft.com/TodoApp/">Here</a>. It is vital that you set up everything correctly in order for Firebase to work. In this project, I will use 3 services Firebase Firestore, Firebase Authentication, and Firebase Storage</p>
<h3><span id="1-authentication">1. Authentication</span></h3>
<h4><span id="11-login-form">1.1 Login Form</span></h4>
<p>Definitely one of the core parts of any project. In this project, I created a Private Router for authentication which will only allow authenticated users to enter the platform.</p>
<p>We start by creating 2 pages with 2 forms: Login and Signup. We will use useRef to handle the value that the users input in both forms.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;Form onSubmit=&#123;handleSubmit&#125;&gt;</span><br><span class="line">  &lt;Form.Group id=<span class="string">"email"</span>&gt;</span><br><span class="line">    &lt;Form.Label&gt;Email&lt;<span class="regexp">/Form.Label&gt;</span></span><br><span class="line"><span class="regexp">    &lt;Form.Control type="email" ref=&#123;emailRef&#125; required&gt;&lt;/</span>Form.Control&gt;</span><br><span class="line">  &lt;<span class="regexp">/Form.Group&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  &lt;Form.Group id="password"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;Form.Label&gt;Password&lt;/</span>Form.Label&gt;</span><br><span class="line">    &lt;Form.Control type=<span class="string">"password"</span> ref=&#123;passwordRef&#125; required&gt;&lt;<span class="regexp">/Form.Control&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Form.Group&gt;</span><br><span class="line"></span><br><span class="line">  &lt;Button disabled=&#123;loading&#125; className=<span class="string">"w-100"</span> type=<span class="string">"submit"</span>&gt;</span><br><span class="line">    Log <span class="keyword">in</span></span><br><span class="line">&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Form&gt;</span><br></pre></td></tr></table></figure>
<p>The form is structure quite standardly. I am using all the components in <strong>react-bootstrap</strong> (Form, Button, Modal). We have 2 form groups correspond to the email and the password. We then save the reference using <strong>useRef</strong> to store the input from user. Finally, there is a button to handle the submit event of the form.</p>
<p>In the <strong>submit</strong> event, we will execute the following actions. First we will run the login function with email and password. This action is loaded from a <strong>useContext</strong> which I will mention later. Then we will store the result of the successful <strong>Authentication</strong> call and save it to the Database and <strong>LocalStorage</strong> (this is used to remember the user if you want to have that feature). I am also using <strong>useHistory</strong> to navigate between the webpages</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">      setError(<span class="string">""</span>)</span><br><span class="line">      setLoading(<span class="literal">true</span>)</span><br><span class="line">      <span class="keyword">await</span> login(emailRef.current.value, passwordRef.current.value)</span><br><span class="line">      .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> name = data.user.displayName.split(<span class="string">" "</span>);</span><br><span class="line">        <span class="keyword">const</span> firstName = name[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">const</span> lastName = name[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> loggedInUser = &#123;</span><br><span class="line">            firstName,</span><br><span class="line">            lastName,</span><br><span class="line">            uid: data.user.uid,</span><br><span class="line">            email: data.user.email</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        localStorage.setItem(<span class="string">'user'</span>, <span class="built_in">JSON</span>.stringify(loggedInUser));</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      history.push(<span class="string">"/"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">      setError(<span class="string">"Failed to login. Please check your password or username and try again"</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>This is an application of try catch function. Note that here the <strong>login</strong> will be imported from our useContext (an Authentication context) and will be described later in section 1.3</p>
<h4><span id="12-signup-form">1.2 Signup Form</span></h4>
<p>This is very similar to the Login Form. It has 5 form groups firstname, lastname, <strong>email, password and confirmpassword</strong> (you can add more but the last 3 is a must).</p>
<p>Here we will also use <strong>useRef</strong> to handle the input value from the users. The Signup Form is below:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;Form onSubmit=&#123;handleSubmit&#125;&gt;</span><br><span class="line">          &lt;Form.Group id=<span class="string">"email"</span>&gt;</span><br><span class="line">            &lt;Form.Label&gt;Email&lt;<span class="regexp">/Form.Label&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Form.Control type="email" ref=&#123;emailRef&#125; required&gt;&lt;/</span>Form.Control&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Group&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">          &lt;Form.Group id="password"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Form.Label&gt;Password&lt;/</span>Form.Label&gt;</span><br><span class="line">            &lt;Form.Control type=<span class="string">"password"</span> ref=&#123;passwordRef&#125; required&gt;&lt;<span class="regexp">/Form.Control&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Form.Group&gt;</span><br><span class="line"></span><br><span class="line">          &lt;Form.Group id=<span class="string">"password-confirm"</span>&gt;</span><br><span class="line">            &lt;Form.Label&gt;Password Confirmation&lt;<span class="regexp">/Form.Label&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Form.Control type="password" ref=&#123;passwordConfirmRef&#125; required&gt;&lt;/</span>Form.Control&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Group&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">          &lt;Form.Group id="first-name"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Form.Label&gt;First Name&lt;/</span>Form.Label&gt;</span><br><span class="line">            &lt;Form.Control type=<span class="string">"first-name"</span> ref=&#123;firstNameRef&#125; required&gt;&lt;<span class="regexp">/Form.Control&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Form.Group&gt;</span><br><span class="line"></span><br><span class="line">          &lt;Form.Group id=<span class="string">"last-name"</span>&gt;</span><br><span class="line">            &lt;Form.Label&gt;Last Name&lt;<span class="regexp">/Form.Label&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Form.Control type="last-name" ref=&#123;lastNameRef&#125; required&gt;&lt;/</span>Form.Control&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Group&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Button disabled=&#123;loading&#125; className="w-100" type="submit"&gt;</span></span><br><span class="line"><span class="regexp">            Sign Up</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Button&gt;</span><br><span class="line">        &lt;<span class="regexp">/Form&gt;</span></span><br></pre></td></tr></table></figure>
<p>Again, very similar to the Login Form, we will have a submit button to handle the <strong>submit event</strong> of the form. Here is when it gets a bit <strong>different</strong>.</p>
<p>We will first check if the <strong>password</strong> is equal to the <strong>confirmpassword</strong>. I think Bootstrap Forms requires 6 characters at the minimum but you can freely add more conditions. If they are equal, we would perform the try catch function just as in the Login Form:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">  setError(<span class="string">""</span>)</span><br><span class="line">  setLoading(<span class="literal">true</span>)</span><br><span class="line">  <span class="keyword">let</span> result = <span class="keyword">await</span> signup(emailRef.current.value, passwordRef.current.value)</span><br><span class="line">  <span class="keyword">await</span> result.user.updateProfile(&#123;</span><br><span class="line">    displayName: firstNameRef.current.value + <span class="string">" "</span> + lastNameRef.current.value</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">await</span> db.collection(<span class="string">"users"</span>).add(&#123;</span><br><span class="line">    email: emailRef.current.value,</span><br><span class="line">    firstName: firstNameRef.current.value,</span><br><span class="line">    lastName: lastNameRef.current.value,</span><br><span class="line">    uid: result.user.uid,</span><br><span class="line">    createdAt: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">    isOnline: <span class="literal">true</span>,</span><br><span class="line">    profileImage: <span class="string">"https://i.pinimg.com/originals/e0/7a/22/e07a22eafdb803f1f26bf60de2143f7b.png"</span>,</span><br><span class="line">    friendList: [],</span><br><span class="line">    pendingFriends: [],</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">const</span> loggedInUser = &#123;</span><br><span class="line">    firstName: firstNameRef.current.value,</span><br><span class="line">    lastName: lastNameRef.current.value,</span><br><span class="line">    uid: result.user.uid,</span><br><span class="line">    email: result.user.email</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">await</span> localStorage.setItem(<span class="string">"user"</span>, <span class="built_in">JSON</span>.stringify(loggedInUser))</span><br><span class="line">  history.push(<span class="string">"/"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span>&#123;</span><br><span class="line">  setError(<span class="string">"Failed to create an account. Password must be at least 6 characters or username already existed"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We set the <strong>result</strong> variable to be the result of the successful call to the signup function of Firebase Authentication. Again, the <strong>signup</strong> function will be <strong>imported</strong> from the <strong>useContext</strong> that we will mention in section 1.3. Then I will update the <strong>displayName</strong> of the currentUser that is successfully signed up to Firebase (note that the displayName is a provided feature). However, as I have mentioned in my <strong>Important Notes</strong> I will uploaded the users’ information to Firestore even if we already have the currentUser from Authentication. This will allows us to freely manage the encripted information and apply it to later stage of the project.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> db.collection(<span class="string">"users"</span>).add(&#123;</span><br><span class="line">  email: emailRef.current.value,</span><br><span class="line">  firstName: firstNameRef.current.value,</span><br><span class="line">  lastName: lastNameRef.current.value,</span><br><span class="line">  uid: result.user.uid,</span><br><span class="line">  createdAt: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">  isOnline: <span class="literal">true</span>,</span><br><span class="line">  profileImage: <span class="string">"https://i.pinimg.com/originals/e0/7a/22/e07a22eafdb803f1f26bf60de2143f7b.png"</span>,</span><br><span class="line">  friendList: [],</span><br><span class="line">  pendingFriends: [],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Here is the function I called to add to my Firestore database. It includes some fields such as <strong>uid</strong> (id given to us from Firebase Authentication), <strong>createdAt</strong> (exact time that the user signed up), isOnline (manage if the user is currently online or not), <strong>profileImage</strong> (to store profile image), <strong>friendList</strong> (to store our current friendlist), and <strong>pendingFriends</strong> (to store the users sent us a request but we have not respond). After pushing the data to Firestore, we are basically done for signup. Now we should switch to Login page and start building our <strong>Dashboard</strong>. Note that in my website I also built a <strong>Update Profile</strong> and a <strong>Forgot Password</strong> page but that is for later and not the main function of the project</p>
<h3><span id="2-friends-relationship-management-add-remove-friends-like-on-facebook">2. Friends relationship management (add, remove friends like on Facebook)</span></h3>
<p>This will be our Dashboard page. It will help you show the personal information, manage your friends, and the list of all users currently using the app so that people can <strong>add friend</strong> and connect to each other. So the core function of this page is to handle <strong>adding and removing</strong> friends. Like I mentioned in the Signup section (1.2), we will use 2 arrays to handle friends <strong>pendingFriends</strong> (users sent us a request but we have not respond) and <strong>friendList</strong> (the people are in our friends’ list)</p>
<p>This is my dashboard page:</p>
<img src="/MessengerClone/dashboard.png">
<p>It has a really simple design with a navigating bar (drawer) to the left side. Now, I will show you how to create the <strong>relationship</strong> between the users.</p>
<p>First, I will use a useEffect to call to the Firestore database and list out all the users that are using the app. In order to do this, we create a <strong>User</strong> component that has 3 props:<br>
<strong>id</strong> (the document id of the friend that I sent a friend request to in Firestore), <strong>docId</strong> (the document id of the current user in Firestore), and <strong>user</strong> (the data of the current usere in Firestore).</p>
<p>Everytime we want to pull real-time information from the database to reflect the changes, we will write a useEffect hook. Here I have <strong>pendingFriends</strong> (users sent us a request but we have not respond) and <strong>sentFriendRequests</strong> (users that we sent a friend request to). Remember this data is taken from the <strong>user</strong> collection in the database</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  db.collection(<span class="string">"users"</span>).doc(docId).onSnapshot(<span class="function">(<span class="params">doc</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (doc.data().pendingFriends) &#123;</span><br><span class="line">      setPendingFriends(doc.data().pendingFriends)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  db.collection(<span class="string">"users"</span>).doc(docId).onSnapshot(<span class="function">(<span class="params">doc</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (doc.data().sentFriendRequests) &#123;</span><br><span class="line">      setSentFriendRequests(doc.data().sentFriendRequests)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>
<p>Second, we will have 4 operations that we want to execute: <strong>sent</strong> a friend request to someone, <strong>accept</strong> a friend request, <strong>decline</strong> a friend request, and <strong>remove</strong> someone from our friend list. The way you handle these actions is up to you but here is how I handle it</p>
<h4><span id="1-sent-a-friend-request-to-someone">1. Sent a friend request to someone</span></h4>
<p>When we sent a friend request to someone, we want to add the document id of that user to our sentFriendRequest list and add the current user’s document id to the pendingList of that user.<br>
For example, A sent to B a request -&gt; add B to <strong>sentFriendRequest</strong> list of A and add A to <strong>pendingList</strong> of B. Here is how to execute it. In Firebase, whenever we want to change a array type data, we can use the <strong>FieldValue.arrayUnion</strong> provided by Firebase</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">const</span> handleAddFriend = <span class="keyword">async</span> (id) =&gt; &#123;</span><br><span class="line">  setPending(<span class="literal">true</span>)</span><br><span class="line">  <span class="keyword">await</span> db.collection(<span class="string">"users"</span>).doc(id).update(&#123;</span><br><span class="line">    pendingFriends: firebase.firestore.FieldValue.arrayUnion(docId)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">await</span> db.collection(<span class="string">"users"</span>).doc(docId).update(&#123;</span><br><span class="line">    sentFriendRequests: firebase.firestore.FieldValue.arrayUnion(id)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4><span id="2-accept-a-friend-request-from-someone">2. Accept a friend request from someone</span></h4>
<p>When A accepts B friend request, we want to add A to B’s <strong>friendList</strong>, add B to A’s friendList, remove B from <strong>pendingList</strong> of A and remove A from <strong>sendFriendRequest</strong> list of B. Here is the code to perform this action</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleAcceptFriend = <span class="keyword">async</span> (id) =&gt; &#123;</span><br><span class="line"><span class="keyword">await</span> db.collection(<span class="string">"users"</span>).doc(docId).update(&#123;</span><br><span class="line">  friendList: firebase.firestore.FieldValue.arrayUnion(id)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> db.collection(<span class="string">"users"</span>).doc(id).update(&#123;</span><br><span class="line">  friendList: firebase.firestore.FieldValue.arrayUnion(docId)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> db.collection(<span class="string">"users"</span>).doc(docId).update(&#123;</span><br><span class="line">  pendingFriends: pendingFriends.filter(<span class="function">(<span class="params">friendId</span>) =&gt;</span> friendId != id &amp;&amp; friendId != docId)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> db.collection(<span class="string">"users"</span>).doc(id).update(&#123;</span><br><span class="line">  sentFriendRequests: sentFriendRequests.filter(<span class="function">(<span class="params">friendId</span>) =&gt;</span> friendId != docId)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4><span id="3-decline-a-friend-request-of-someone">3. Decline a friend request of someone</span></h4>
<p>When A declines the friend request from B, we basically just remove B from the pendingList of A and remove A from the sentFriendRequest of B</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleDeclineFriend = <span class="keyword">async</span> (id) =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> db.collection(<span class="string">"users"</span>).doc(id).update(&#123;</span><br><span class="line">    pendingFriends: pendingFriends.filter(<span class="function">(<span class="params">friendId</span>) =&gt;</span> friendId != id &amp;&amp; friendId != docId)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> db.collection(<span class="string">"users"</span>).doc(docId).update(&#123;</span><br><span class="line">    pendingFriends: pendingFriends.filter(<span class="function">(<span class="params">friendId</span>) =&gt;</span> friendId != id &amp;&amp; friendId != docId)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> db.collection(<span class="string">"users"</span>).doc(id).update(&#123;</span><br><span class="line">    sentFriendRequests: sentFriendRequests.filter(<span class="function">(<span class="params">friendId</span>) =&gt;</span> friendId != id &amp;&amp; friendId != docId)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h4><span id="4-remove-someone-from-our-friendlist">4. Remove someone from our friendlist</span></h4>
<p>When A removes B from A’s friendlist, we want to remove A from B’s friendList and remove B from A’s friendList.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleRemoveFriend = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  e.preventDefault()</span><br><span class="line">  <span class="comment">// console.log(friendList)</span></span><br><span class="line">  db.collection(<span class="string">"users"</span>).doc(docId).update(&#123;</span><br><span class="line">    friendList: friendList.filter(<span class="function">(<span class="params">friend</span>) =&gt;</span> friend != friendId &amp;&amp; friend != docId)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  db.collection(<span class="string">"users"</span>).doc(friendId).update(&#123;</span><br><span class="line">    friendList: friendList.filter(<span class="function">(<span class="params">friend</span>) =&gt;</span> friend != docId &amp;&amp; friend != friendId)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>Right now, we are done with the friends’ relationship operations. Now we will try to display the operations to the screen in the way we want. For example, our current user is <strong>A</strong>. Note that the <em>logic</em> will flow like this. First, next to every user (that is not our friend yet) in the List of Users will have a “<strong>add friend</strong>” button. After sending <strong>B</strong> a friend request, we will change that button to <strong>Pending</strong> and disable it. Then in B’s screen, the buttons next to A will be <strong>yes/no</strong> (represent if B want to add friend A or not). If B choose yes, they will both be added to each other’s <strong>friendList</strong> and remove from the each other list of users. If B choose no, then A will be removed from B’s users list. Here is the ternary expression I used to display this logic in the Dashboard</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">            sentFriendRequests &amp;&amp; sentFriendRequests.includes(id) ?</span><br><span class="line">              (</span><br><span class="line">                &lt;Button onClick=&#123;() =&gt; handleAddFriend(id)&#125; disabled=&#123;<span class="literal">true</span>&#125;&gt;Pending&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">              )</span></span><br><span class="line"><span class="regexp">              :</span></span><br><span class="line"><span class="regexp">              (</span></span><br><span class="line"><span class="regexp">                &lt;div&gt;</span></span><br><span class="line"><span class="regexp">                  &#123;pendingFriends &amp;&amp; pendingFriends.includes(id) ?</span></span><br><span class="line"><span class="regexp">                    (</span></span><br><span class="line"><span class="regexp">                      &lt;div style=&#123;&#123;display: "flex", flexDirection:"row"&#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Button style=&#123;&#123;marginRight: 20&#125;&#125; onClick=&#123;() =&gt; handleAcceptFriend(id)&#125;&gt;</span></span><br><span class="line"><span class="regexp">                          &lt;FontAwesomeIcon style=&#123;&#123;fontSize: 16&#125;&#125; icon=&#123;faCheck&#125;/</span>&gt;</span><br><span class="line">                        &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;Button onClick=&#123;() =&gt; handleDeclineFriend(id)&#125;&gt;</span></span><br><span class="line"><span class="regexp">                          &lt;FontAwesomeIcon style=&#123;&#123;fontSize: 20&#125;&#125; icon=&#123;faTimes&#125;/</span>&gt;</span><br><span class="line">                        &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">                      &lt;/</span>div&gt;</span><br><span class="line">                    )</span><br><span class="line">                    :</span><br><span class="line">                    (</span><br><span class="line">                      &lt;&gt;</span><br><span class="line">                        &lt;Button onClick=&#123;() =&gt; handleAddFriend(id)&#125; disabled=&#123;pending&#125;&gt;&#123;pending ? <span class="string">"Pending"</span> : (</span><br><span class="line">                          &lt;FontAwesomeIcon icon=&#123;faUserPlus&#125;/&gt;</span><br><span class="line">                        )&#125;&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">                      &lt;/</span>&gt;</span><br><span class="line">                    )</span><br><span class="line">                  &#125;</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">              )</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br></pre></td></tr></table></figure>
<p>The rest of the dashboard is pretty simple. Here is where I list of the current users that are not my friend.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">userList &amp;&amp; userList.map(<span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!friendList.includes(user.id)) &#123;</span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">            &lt;User id=&#123;user.id&#125; docId=&#123;docId&#125; user=&#123;user.user&#125; /&gt;</span><br><span class="line">          )</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br></pre></td></tr></table></figure>
<img src="/MessengerClone/allusers.png">
<p>And here is where I list my friends in the left side of the dashboard.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;friendList &amp;&amp; friendList.map(<span class="function">(<span class="params">friendId</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Friend sentFriendRequests=&#123;sentFriendRequests&#125; friendList=&#123;friendList&#125; docId=&#123;docId&#125; friendId=&#123;friendId&#125; /&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;)&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="3-firebase-storage-to-store-and-upload-images">3. Firebase storage to store and upload images</span></h3>
<p>One of the most important features in the app is to handle <strong>profile images</strong>: upload or change them. Here we will use Firebase <strong>Storage</strong> to upload the image and then extract the <strong>link</strong> from Storage to store it to corresponding users’ database</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=<span class="string">"file"</span> onChange=&#123;handleImageAsFile&#125; /&gt;</span><br><span class="line">&lt;button onClick=&#123;handleFirebaseUpload&#125;&gt;Upload&lt;<span class="regexp">/button&gt;</span></span><br></pre></td></tr></table></figure>
<p>We will display these 2 basic HTML on the screen. 1 is an input where we set the type to files. We will only accept image format here. I will capture the event <strong>handleImageAsFile</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleImageAsFile = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> image = e.target.files[<span class="number">0</span>]</span><br><span class="line">  setImageAsFile(<span class="function"><span class="params">imageAsFile</span> =&gt;</span> image)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here is an example of the files in storage. Remember the path that leads to the images is:<br>
&quot;/images/{name of image}&quot;</p>
<img src="/MessengerClone/storage.png">
<p>We save our image to a state <strong>imageAsFile</strong>. This will be a <strong>Image File</strong> so we cannot access this yet. From here we have to extract the link to this file from Storage. We will first <strong>upload</strong> the image we selected to Firebase Storage and <strong>access</strong> the <strong>path</strong> that leads to the image using reference and the method <strong>getDownloadURL</strong> of Firebase.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleFirebaseUpload = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  e.preventDefault()</span><br><span class="line">  <span class="keyword">if</span> (imageAsFile === <span class="string">''</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`not an image`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> uploadTask = storage.ref(<span class="string">`/images/<span class="subst">$&#123;imageAsFile.name&#125;</span>`</span>).put(imageAsFile)</span><br><span class="line">  uploadTask.on(<span class="string">"state_changed"</span>, (snapShot) =&gt; &#123;</span><br><span class="line">  &#125;, (err) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">  &#125;, () =&gt; &#123;</span><br><span class="line">    storage.ref(<span class="string">'images'</span>).child(imageAsFile.name).getDownloadURL()</span><br><span class="line">      .then(<span class="function"><span class="params">fireBaseUrl</span> =&gt;</span> &#123;</span><br><span class="line">        setImageAsUrl(<span class="function"><span class="params">prevObject</span> =&gt;</span> (&#123; ...prevObject, <span class="attr">imgUrl</span>: fireBaseUrl &#125;))</span><br><span class="line">        db.collection(<span class="string">"users"</span>).doc(docId).update(&#123;</span><br><span class="line">          profileImage: fireBaseUrl</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  setOpen(<span class="literal">false</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here we will get our downloadURL of the image to be <strong>firebaseURL</strong>. After receiving this, we will save this to the <strong>corresponding</strong> user database of that user. Now all we have to do is take the URL and display it on the screen</p>
<h3><span id="4-real-time-messaging-of-individuals-using-firestore-and-redux">4. Real-time messaging of individuals using Firestore and Redux</span></h3>
<p>It has been quite a long set up right … We are finally here, the most important and also the core feature of my project the real-time chat between individuals and groups. In this section 4, I will show you how to use Redux to do real-time messaging.</p>
<p>First we need to set up <strong>Redux and Redux Thunk</strong> (this is critical in order to perform asynchronous actions in Redux)</p>
<p>First in the main index.js outside, we must set up as the following:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;BrowserRouter&gt;</span><br><span class="line">        &lt;App /&gt;</span><br><span class="line">    &lt;<span class="regexp">/BrowserRouter&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Provider&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>Basically, the <strong>store</strong> variable will be from Redux and it will contain all of our states. We just need to <strong>wrap</strong> our App with the <strong>Provider</strong> and we are good to go.</p>
<p>Now we will set up the reducer where will we perform the messaging logic. Below is my reducer folder structure. We will not need the authReducer but just an index.js file and the userReducer</p>

<p>The user.reducer.js will contain all the definitions for the actions (name, type and corresponding payload) that we will perform</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; userConstants &#125; <span class="keyword">from</span> <span class="string">"../actions/constants"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initState = &#123;</span><br><span class="line">  users: []</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state = initState, action) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">`<span class="subst">$&#123;userConstants.GET_REALTIME_USERS&#125;</span>_REQUEST`</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">`<span class="subst">$&#123;userConstants.GET_REALTIME_USERS&#125;</span>_SUCCESS`</span>:</span><br><span class="line">      state = &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        users: action.payload.users</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> userConstants.GET_REALTIME_MESSAGES:</span><br><span class="line">      state = &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        conversations: action.payload.conversations</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">`<span class="subst">$&#123;userConstants.GET_REALTIME_MESSAGES&#125;</span>_FAILURE`</span>:</span><br><span class="line">      state = &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        conversations: []</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> userConstants.GET_REALTIME_MESSAGES_GROUP:</span><br><span class="line">      <span class="comment">// console.log("have sent message group")</span></span><br><span class="line">      state = &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        conversationsGroup: action.payload.conversationsGroup</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">`<span class="subst">$&#123;userConstants.GET_REALTIME_MESSAGES_GROUP&#125;</span>_FAILURE`</span>:</span><br><span class="line">      state = &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        conversationsGroup: []</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The most important actions here are GET_REALTIME_MESSAGES and GET_REALTIME_MESSAGES_GROUP. In these actions, we will update the <strong>state</strong> conversations (for individuals chat) and conversationsGroup (for group chat) with the <strong>corresponding</strong> newState we got after the user texts something.</p>
<p>Next we will set up the most <strong>important</strong> file of the webchat, <strong>user.action.js</strong>. This is where all the magic happens !</p>
<p>The first <strong>asynchronous</strong> action we will perform is <strong>createMessage</strong>. This is fired when the user sends something to another person.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createMessage = <span class="function">(<span class="params">messageObject</span>) =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">    db.collection(<span class="string">"conversations"</span>).add(&#123;</span><br><span class="line">      ...messageObject,</span><br><span class="line">      isView: <span class="literal">false</span>,</span><br><span class="line">      createdAt: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// console.log(data)</span></span><br><span class="line">      <span class="comment">//success</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Remember using <strong>Redux Thunk</strong> will help us perform async functions like above. We have a parameter <strong>messageObject</strong>. This parameter will be taken from the client side after the user sent something. REMEMBER THIS PARAMETER.</p>
<p>After firing createMessage, we will instantly fire the next function below:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getRealTimeConversations = <span class="function">(<span class="params">user</span>) =&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> (dispatch) =&gt; &#123;</span><br><span class="line">    db.collection(<span class="string">"conversations"</span>)</span><br><span class="line">    .where(<span class="string">'user_uid_2'</span>, <span class="string">'in'</span>, [user.uid_1, user.uid_2])</span><br><span class="line">    <span class="comment">// .where('user_uid_2', 'in', [user.uid_2, user.uid_1])</span></span><br><span class="line">    .orderBy(<span class="string">"createdAt"</span>, <span class="string">"asc"</span>)</span><br><span class="line">    .onSnapshot(<span class="function">(<span class="params">snapShot</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> conversations = []</span><br><span class="line">      <span class="comment">//doc.data() -&gt; vao 1 document</span></span><br><span class="line">      snapShot.forEach(<span class="function">(<span class="params">doc</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//nếu như conversation của 2 người match, 1 người là ng gửi và ng kia nhận được </span></span><br><span class="line">        <span class="comment">// thì mới push vào conversation</span></span><br><span class="line">        <span class="keyword">if</span>((doc.data().user_uid_1 === user.uid_1 &amp;&amp; doc.data().user_uid_2 === user.uid_2)</span><br><span class="line">        ||</span><br><span class="line">        (doc.data().user_uid_1 === user.uid_2 &amp;&amp; doc.data().user_uid_2 === user.uid_1))&#123;</span><br><span class="line">          conversations.push(&#123;<span class="attr">id</span>: doc.id, <span class="attr">conver</span>: doc.data()&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// console.log(conversations)</span></span><br><span class="line">      &#125;)</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: userConstants.GET_REALTIME_MESSAGES,</span><br><span class="line">        payload: &#123; conversations &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>All the encrypted messages will be stored in the conversations collection in Firestore. Here everytime a person sends a message to another person, <strong>we will retake all the data from that conversation in Firestore and add the new message</strong>. This might seem to be time consuming but the next filtering step will improve our <strong>performance</strong> by a lot.</p>
<p>To query and filter in the Firebase, I use the <strong>where</strong> method. The user.uid_1 and user.uid_2 are the ids (generated by the Firebase Authentication) of the current user and the person you are messaging to. Whenever the <strong>current user</strong> sends a message, it will <strong>reload</strong> the <em>conversation</em> in the database and it will look for all conversation with the user_uid_2 that is contained in the array [user.uid_1 and user.uid_2]. This will ensure that if A sends a message to B, the first <strong>filter</strong> will get all the <strong>conversations</strong> that B is either the sender or the receiver.</p>
<p>Then we sort the order by ascending because we want the lastest messages to be seen last. Finally, this condition will check if the conversation we are taking from the database is exactly the conversation between A and B</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>((doc.data().user_uid_1 === user.uid_1 &amp;&amp; doc.data().user_uid_2 === user.uid_2)</span><br><span class="line">  ||</span><br><span class="line">  (doc.data().user_uid_1 === user.uid_2 &amp;&amp; doc.data().user_uid_2 === user.uid_1))&#123;</span><br><span class="line">    conversations.push(&#123;<span class="attr">id</span>: doc.id, <span class="attr">conver</span>: doc.data()&#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>After that we will <strong>dispatch</strong> the action with the payload of conversations so that our reducer file will receive the action. So we are finished with the user.action.js. We have finished setting up for the real-time chat. Now let’s move to the HomePage Screen (which is the Chat screen)</p>
<p>const initChat = (user) =&gt; {<br>
setCurrentChatId(<a href="http://user.id" target="_blank" rel="noopener">user.id</a>)<br>
setChatStarted(true)<br>
setChatGroup(false)<br>
setChatUser(<code>${user.data.firstName} ${user.data.lastName}</code>)<br>
dispatch(getRealTimeConversations({ uid_1: docId, uid_2: <a href="http://user.id" target="_blank" rel="noopener">user.id</a> }))<br>
// setUserUid(user.data.uid)<br>
// console.log(user)<br>
}</p>
<p>First, we have to set up the conversations column, which lists all of our friends and groups (just like in Messenger). Here is the set up for the column</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    newCurrentFriendList &amp;&amp; newCurrentFriendList.map(<span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(user.id != docId)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          &lt;User chatGroup=&#123;chatGroup&#125; currentChatId=&#123;currentChatId&#125; id=&#123;user.id&#125; key=&#123;user.data.uid&#125; user=&#123;user&#125; onClick=&#123;initChat&#125; /&gt;</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>
<p>We will map out all of the current user’s friends, each in a component called <strong>User</strong>.</p>
<img src="/MessengerClone/sideconver.png">
<p>When we <strong>click</strong> into each user, we will have to initiate the conversations between 2 people (which means we need to use the <strong>actions</strong> we just wrote in Redux).</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initChat = <span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">  setCurrentChatId(user.id)</span><br><span class="line">  setChatStarted(<span class="literal">true</span>)</span><br><span class="line">  setChatGroup(<span class="literal">false</span>)</span><br><span class="line">  setChatUser(<span class="string">`<span class="subst">$&#123;user.data.firstName&#125;</span> <span class="subst">$&#123;user.data.lastName&#125;</span>`</span>)</span><br><span class="line">  dispatch(getRealTimeConversations(&#123; <span class="attr">uid_1</span>: docId, <span class="attr">uid_2</span>: user.id &#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We get the <strong>id</strong> of the user that we just clicked into as <strong>id</strong>. Then we set the ChatUser as the name of the user we are chatting with. Finally, we dispatch the action <strong>getRealTimeConversations</strong> to load all the conversations with that person.</p>
<p>Next, when we send a message to a user, we need to initiate the the <strong>sendMessage</strong> function to execute the action we did in user.action.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sendMessage = <span class="keyword">async</span> (e) =&gt; &#123;</span><br><span class="line">  e.preventDefault()</span><br><span class="line">  <span class="keyword">const</span> messageObject = &#123;</span><br><span class="line">    user_uid_1: docId,</span><br><span class="line">    user_uid_2: currentChatId,</span><br><span class="line">    message: message,</span><br><span class="line">    haveReply: replyMessage ? <span class="literal">true</span> : <span class="literal">false</span>,</span><br><span class="line">    replyMessage: replyMessage</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(messageObject)</span><br><span class="line">  <span class="keyword">if</span> (message) &#123;</span><br><span class="line">    dispatch(createMessage(messageObject))</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setMessage(<span class="string">''</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  setReplyMessage(<span class="string">""</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Remember the <strong>messageObject</strong> that I told you to remember. Inside the messageObject will be all the information about the 2 users and that message: <strong>message</strong> (the text that the user sent), <strong>haveReply</strong> (Is the message replied or not), <strong>replyMessage</strong> (the replyMessage if this message has 1). Finally, we will dispatch the <strong>createMessage</strong> action from the user.action.js</p>
<p>Here is the most sophisticated part of the project, where I set up and display all the messages:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">(chatStarted &amp;&amp; !chatGroup) ?</span><br><span class="line">user.conversations &amp;&amp; user.conversations.map(<span class="function">(<span class="params">conver</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div style=&#123;&#123; <span class="attr">textAlign</span>: conver.conver.user_uid_1 == docId ? <span class="string">'right'</span> : <span class="string">"left"</span> &#125;&#125;&gt;</span><br><span class="line">      &#123;</span><br><span class="line">        conver.conver.user_uid_1 == docId ?</span><br><span class="line">          (&lt;div className="maindiv" style=&#123;&#123; display: "flex", flexDirection: "column", alignItems: "flex-end", zIndex: 9999 &#125;&#125;&gt;</span><br><span class="line">            &#123;(open6 &amp;&amp; (currentMessageEmoji &amp;&amp; currentMessageEmoji == conver.id)) ? (</span><br><span class="line">              &lt;div className="emojiContainer"&gt;</span><br><span class="line">                &lt;div onClick=&#123;(e) =&gt; handleReaction(e, conver.id)&#125; className="emoji-li"&gt;&#123;emoji.getUnicode("heart")&#125;&lt;/div&gt;</span><br><span class="line">                &lt;div onClick=&#123;(e) =&gt; handleReaction(e, conver.id)&#125; className="emoji-li"&gt;&#123;emoji.getUnicode(emoji.names[11])&#125;&lt;/div&gt;</span><br><span class="line">                &lt;div onClick=&#123;(e) =&gt; handleReaction(e, conver.id)&#125; className="emoji-li"&gt;&#123;emoji.getUnicode(emoji.names[70])&#125;&lt;/div&gt;</span><br><span class="line">                &lt;div onClick=&#123;(e) =&gt; handleReaction(e, conver.id)&#125; className="emoji-li"&gt;&#123;emoji.getUnicode(emoji.names[73])&#125;&lt;/div&gt;</span><br><span class="line">                &lt;div onClick=&#123;(e) =&gt; handleReaction(e, conver.id)&#125; className="emoji-li"&gt;&#123;emoji.getUnicode(emoji.names[55])&#125;&lt;/div&gt;</span><br><span class="line">                &lt;div onClick=&#123;(e) =&gt; handleReaction(e, conver.id)&#125; className="emoji-li"&gt;&#123;emoji.getUnicode(emoji.names[116])&#125;&lt;/div&gt;</span><br><span class="line">                &lt;div onClick=&#123;(e) =&gt; handleReaction(e, conver.id)&#125; className="emoji-li"&gt;&#123;emoji.getUnicode(emoji.names[117])&#125;&lt;/div&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            ) : null&#125;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">              &lt;div className="maindiv" key=&#123;conver.id&#125; className="messageContainerCurrent"&gt;</span><br><span class="line">                &lt;div className="hide" id=&#123;conver.id&#125; onClick=&#123;(e) =&gt; handleShowEmojis(e, conver.id)&#125;&gt;&#123;emoji.getUnicode("grinning")&#125;&lt;/div&gt;</span><br><span class="line">                &lt;FontAwesomeIcon className="hide" onClick=&#123;(e) =&gt; handleReplyMess(e, conver.id)&#125; icon=&#123;faReply&#125; /&gt;</span><br><span class="line">                &lt;div className=&#123;conver.conver.user_uid_1 == docId ? "messageStyle" : "messageStyleWhite"&#125; &gt;</span><br><span class="line">                  &#123;conver.conver.haveReply ? (</span><br><span class="line">                    &lt;div className="chatReplyMessage"&gt;</span><br><span class="line">                      &#123;conver.conver.replyMessage&#125;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                  ) : null&#125;</span><br><span class="line">                  &#123;conver.conver.message&#125;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;div className="emojiMessage" style=&#123;&#123; position: "absolute", right: "1%", marginTop: -16 &#125;&#125;&gt;&#123;conver.conver.emojiSingle&#125;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          )</span><br><span class="line">          :</span><br></pre></td></tr></table></figure>
<p>The above code is the display of the message from the sender. The message from the receiver will be the same but just  A <strong>message</strong> can be splited into <strong>4 parts</strong>:</p>
<ol>
<li>Checking what user this is the sender or the receiver</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conver.conver.user_uid_1 == docId ?</span><br></pre></td></tr></table></figure>
<p>This line of code helps us know that this is the sender of the message.</p>
<ol start="2">
<li>Emoji container</li>
</ol>
<p>Do you know the emojis we typically use in Messenger. Here we use a emoji unicode library to display the emojis</p>
<ol start="3">
<li>Showing the Reacted Emoji</li>
</ol>
<p>Here is where we handle the event of a user reacts to a message. We need a container to display the emoji. For individuals chatting, we only need to add an <strong>emojiSelected</strong> field in each message document.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleReaction = <span class="keyword">async</span> (e, id) =&gt; &#123;</span><br><span class="line">  e.preventDefault()</span><br><span class="line">  setSelectedEmoji(e.currentTarget.textContent)</span><br><span class="line">  <span class="keyword">const</span> emojiSelected = e.currentTarget.textContent</span><br><span class="line">  <span class="keyword">await</span> db.collection(<span class="string">"conversations"</span>).doc(id).update(&#123;</span><br><span class="line">    emojiSingle: emojiSelected == selectedEmojiOnDatabase ? <span class="string">""</span> : emojiSelected</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">await</span> db.collection(<span class="string">"conversations"</span>).doc(id).onSnapshot(<span class="function">(<span class="params">doc</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (doc) &#123;</span><br><span class="line">      setSelectedEmojiOnDatabase(doc.data().emojiSingle)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  setOpen6(<span class="literal">false</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>Displaying the Reply portion</li>
</ol>
<p>Of course, we need a reply function for each message. Here we basically add another field <strong>replyMessage</strong> to each message document in the database.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleReplyMess = <span class="function">(<span class="params">e, id</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log("reply")</span></span><br><span class="line">  e.preventDefault()</span><br><span class="line">  db.collection(<span class="string">"conversations"</span>).doc(id).get().then(<span class="function">(<span class="params">doc</span>) =&gt;</span> &#123;</span><br><span class="line">    setReplyMessage(doc.data().message)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And thats it, we can now chat individually to each other. For the groups’s function is really similar to the individual chat so I will let the <a href="https://github.com/MRSNOO/Messenger-Clone-New" target="_blank" rel="noopener">Github Link to Project</a> so that you can understand it better. Here is the link to the Website <a href="https://todoapp-aaff8.web.app/" target="_blank" rel="noopener">MessengerClone</a>. I hope you can experience the website and give me some feedback.</p>
<h3><span id="i-hope-you-like-this-post-it-is-really-long-but-it-contains-a-lot-of-useful-information-about-web-technologies-i-will-see-you-guys-in-my-next-post">I hope you like this post. It is really long but it contains a lot of useful information about web technologies. I will see you guys in my next post.</span></h3>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/Dashboard-App/" data-toggle="tooltip" data-placement="top" title="Post#8 Create and upload a mobile application to App Store and Google Play Store">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/TodoApp/" data-toggle="tooltip" data-placement="top" title="Post#6 CRUD Todo App with Firebase">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <!-- duoshuo Share start -->
                

                

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->
            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">Welcome back to my tech blog. This time I will show you my work during the winter break: Messenger Clone</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">List of important parts in the project:</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">Important Note:</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text">Setting Up Firebase in a React Project</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.4.</span> <span class="toc-nav-text">1. Authentication</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.4.1.</span> <span class="toc-nav-text">1.1 Login Form</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.4.2.</span> <span class="toc-nav-text">1.2 Signup Form</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.5.</span> <span class="toc-nav-text">2. Friends relationship management (add, remove friends like on Facebook)</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.5.1.</span> <span class="toc-nav-text">1. Sent a friend request to someone</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.5.2.</span> <span class="toc-nav-text">2. Accept a friend request from someone</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.5.3.</span> <span class="toc-nav-text">3. Decline a friend request of someone</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.5.4.</span> <span class="toc-nav-text">4. Remove someone from our friendlist</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.6.</span> <span class="toc-nav-text">3. Firebase storage to store and upload images</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.7.</span> <span class="toc-nav-text">4. Real-time messaging of individuals using Firestore and Redux</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#null"><span class="toc-nav-number">1.8.</span> <span class="toc-nav-text">I hope you like this post. It is really long but it contains a lot of useful information about web technologies. I will see you guys in my next post.</span></a></li></ol></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#javascript" title="javascript">javascript</a>
                        
                          <a class="tag" href="/tags/#reactjs" title="reactjs">reactjs</a>
                        
                          <a class="tag" href="/tags/#nodejs" title="nodejs">nodejs</a>
                        
                          <a class="tag" href="/tags/#api" title="api">api</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
            </div>
        </div>
    </div>
</article>







<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
        //   icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                

                
                    <li>
                        <a target="_blank" href="https://instagram.com/quang.sot.1412">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/quang.sot.1412">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="https://github.com/Quang">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Quang Nguyen 2021 
                    <br>
                    Created by <a href="https://www.facebook.com/quang.sot.1412">Quang</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    from <a href="https://github.com/">MrSnoo</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=QUANG&repo=CodeBlog&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://decodecraft.com/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<img src="https://decodecraft.com/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
